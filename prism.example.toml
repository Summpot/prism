#:schema https://raw.githubusercontent.com/Summpot/prism/master/prism.schema.json
admin_addr = ":8080"
proxy_protocol_v2 = false
buffer_size = 32768
upstream_dial_timeout_ms = 5000
max_header_bytes = 65536

# Public-facing proxy listeners (multi-port / multi-protocol).
#
# TCP listeners can run in hostname-routing mode (Minecraft handshake / TLS SNI)
# or in fixed forwarding mode.
# UDP listeners run in fixed forwarding mode.

[[listeners]]
listen_addr = ":25565"
protocol = "tcp"

# If upstream is omitted for a TCP listener, Prism uses hostname routing.
# If upstream is set, Prism forwards to that fixed upstream.

# Example UDP game port forwarding (direct):
[[listeners]]
listen_addr = ":19132"
protocol = "udp"
upstream = "127.0.0.1:19132"

[tunnel]
auth_token = ""

# When true, prisms will automatically open server-side listeners for tunnel
# services that specify remote_addr (frp-like behavior).
auto_listen_services = true

# Configure one or more tunnel endpoints. Multiple endpoints allow serving
# multiple transports at the same time (similar to frp's server).

[[tunnel.endpoints]]
listen_addr = ":7000"
transport = "tcp" # tcp | udp | quic

[[tunnel.endpoints]]
listen_addr = ":7001"
transport = "quic"

[tunnel.endpoints.quic]
# If transport=quic and cert/key are empty, prism will generate a self-signed
# certificate at startup.
cert_file = ""
key_file = ""

# Optional: tunnel client role (uncomment to enable).
#
# [tunnel.client]
# server_addr = "127.0.0.1:7000"
# transport = "tcp" # tcp | udp | quic
# dial_timeout_ms = 5000
#
# [tunnel.client.quic]
# server_name = "localhost"
# insecure_skip_verify = true
#
# [[tunnel.services]]
# name = "home-mc"
# proto = "tcp" # tcp | udp
# local_addr = "127.0.0.1:25565"
# route_only = true # optional. If true, only reachable via routes (tunnel:home-mc).
# remote_addr = ":25565" # optional (frp-like). If set, prisms opens this listener automatically.

[logging]
level = "info"
format = "json"
output = "stderr"
add_source = false

[opentelemetry]
enabled = false
service_name = "prism"
otlp_endpoint = "" # e.g. http://127.0.0.1:4317 (OTLP/gRPC) or http://127.0.0.1:4318 (OTLP/HTTP)
protocol = "grpc" # grpc | http
timeout_ms = 5000

# Optional OTLP headers (useful for auth when exporting directly to a SaaS endpoint).
#
# [opentelemetry.headers]
# "Authorization" = "Bearer <token>"

[opentelemetry.ui]
logs_url = ""   # optional: link to your external logs UI
traces_url = "" # optional: link to your external traces UI
metrics_url = "" # optional: link to your external metrics UI

[reload]
enabled = true
poll_interval_ms = 1000

[[routing_parsers]]
type = "wasm"
name = "minecraft_handshake"
path = "builtin:minecraft_handshake"

[[routing_parsers]]
type = "wasm"
name = "tls_sni"
path = "builtin:tls_sni"

[timeouts]
handshake_timeout_ms = 3000
idle_timeout_ms = 0

[[routes]]
host = "play.example.com"
upstream = "127.0.0.1:25566"

# Wildcards ('*' and '?') support capture groups that can be substituted into upstreams
# using $1, $2, ... (see DESIGN.md for details).
[[routes]]
host = "*.labs.example.com"
upstreams = ["127.0.0.1:25567", "127.0.0.1:25568"]
strategy = "round-robin"
cache_ping_ttl = "60s"

[[routes]]
host = "home.example.com"
upstream = "tunnel:home-mc"
