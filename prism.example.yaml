# yaml-language-server: $schema=./prism.schema.json

admin_addr: ":8080"

# Public-facing proxy listeners (multi-port / multi-protocol).
listeners:
  - listen_addr: ":25565"
    protocol: "tcp"
    # If upstream is omitted for a TCP listener, Prism uses hostname routing.
    # If upstream is set, Prism forwards to that fixed upstream.
  # Example UDP game port forwarding (direct):
  - listen_addr: ":19132"
    protocol: "udp"
    upstream: "127.0.0.1:19132"

logging:
  level: "info"
  format: "json"
  output: "stderr"
  add_source: false

opentelemetry:
  enabled: false
  service_name: "prism"
  otlp_endpoint: "" # e.g. http://127.0.0.1:4317 (OTLP/gRPC) or http://127.0.0.1:4318 (OTLP/HTTP)
  protocol: "grpc" # grpc | http
  timeout_ms: 5000
  headers: {}
  ui:
    logs_url: "" # optional: link to your external logs UI
    traces_url: "" # optional: link to your external traces UI
    metrics_url: "" # optional: link to your external metrics UI

proxy_protocol_v2: false
buffer_size: 32768
upstream_dial_timeout_ms: 5000

reload:
  enabled: true
  poll_interval_ms: 1000

max_header_bytes: 65536

tunnel:
  auth_token: ""
  # When true, prisms will automatically open server-side listeners for tunnel
  # services that specify remote_addr (frp-like behavior).
  auto_listen_services: true
  endpoints:
    - listen_addr: ":7000"
      transport: "tcp" # tcp | udp | quic
    - listen_addr: ":7001"
      transport: "quic"
      quic:
        # If transport=quic and cert/key are empty, prism will generate a self-signed
        # certificate at startup.
        cert_file: ""
        key_file: ""

  # Optional: tunnel client role (uncomment to enable).
  # client:
  #   server_addr: "127.0.0.1:7000"
  #   transport: "tcp" # tcp | udp | quic
  #   dial_timeout_ms: 5000
  #   quic:
  #     server_name: "localhost"
  #     insecure_skip_verify: true
  #
  # services:
  #   - name: "home-mc"
  #     proto: "tcp" # tcp | udp
  #     local_addr: "127.0.0.1:25565"
  #     route_only: true # optional. If true, only reachable via routes (tunnel:home-mc).
  #     remote_addr: ":25565" # optional (frp-like). If set, prisms opens this listener automatically.

routing_parsers:
  - type: "wasm"
    name: "minecraft_handshake"
    path: "builtin:minecraft_handshake"
  - type: "wasm"
    name: "tls_sni"
    path: "builtin:tls_sni"

timeouts:
  handshake_timeout_ms: 3000
  idle_timeout_ms: 0

routes:
  - host: "play.example.com"
    upstream: "127.0.0.1:25566"

  # Wildcards ('*' and '?') support capture groups that can be substituted into upstreams
  # using $1, $2, ... (see DESIGN.md for details).
  - host: "*.labs.example.com"
    upstreams:
      - "127.0.0.1:25567"
      - "127.0.0.1:25568"
    strategy: "round-robin"
    cache_ping_ttl: "60s"

  - host: "home.example.com"
    upstream: "tunnel:home-mc"
